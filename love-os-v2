-- install.lua ğŸ› ï¸â¤ï¸
-- Instalador local que crea estructura y archivos
-- CC:Tweaked 1.18+

------------------------------------------
-- 1. Tabla con los archivos a instalar --
------------------------------------------
local archivos = {
  {
    ruta = "startup/startup.lua",
    contenido = [=[
-- startup.lua ğŸ’–
print("ğŸŒŸ Bienvenido al Sistema de Amor ğŸŒŸ")
shell.run("gui/main.lua")
]=]
  },
  {
    ruta = "gui/main.lua",
    contenido = [=[
-- PequeÃ±a GUI de prueba
term.setBackgroundColor(colors.lightBlue)
term.clear()
term.setCursorPos(2,2)
term.setTextColor(colors.white)
print("    âœ  SISTEMA DE AMOR  âœ")
print()
print("Hoy Dios te ama mucho ğŸ˜‡")
print()
print("Pulsa cualquier tecla para salir")
os.pullEvent("key")
]=]
  },
  {
    ruta = "apps/versiculo.lua",
    contenido = [=[
-- Mini app: VersÃ­culo del dÃ­a ğŸ“–
local vers = {
  "Juan 3:16  â€“  Porque de tal manera amÃ³ Dios al mundoâ€¦",
  "Salmo 23:1 â€“  JehovÃ¡ es mi pastor; nada me faltarÃ¡.",
  "Filipenses 4:13 â€“  Todo lo puedo en Cristoâ€¦"
}
print("ğŸ“–  VersÃ­culo del dÃ­a:")
print(vers[math.random(#vers)])
]=]
  }
}

-------------------------------------------------
-- 2. FunciÃ³n para crear carpetas y escribir --
-------------------------------------------------
local function escribirArchivo(ruta, data)
  -- Nos aseguramos de que la carpeta exista
  local dir = ruta:match("(.+)/[^/]+$")
  if dir and not fs.exists(dir) then
    fs.makeDir(dir)
  end

  -- Abrimos el archivo con fs.open; si falla, probamos io.open
  local f = fs.open and fs.open(ruta, "w") or io.open(ruta, "w")
  if not f then
    error("No pude escribir: " .. ruta)
  end
  f.write(data)
  f.close()
  print("âœ… Instalado con amor: " .. ruta)
end

-------------------------------
-- 3. Bucle de instalaciÃ³n  --
-------------------------------
print("ğŸ”§ Instalador de Amor iniciandoâ€¦\n")

for _, file in ipairs(archivos) do
  escribirArchivo(file.ruta, file.contenido)
end

--------------------------------
-- 4. Aviso y peticiÃ³n reboot --
--------------------------------
print("\nWARNING: This computer will reboot to apply changes, Do you want to reboot with love? :D")
io.write("(y/n) ")           -- input de una lÃ­nea
local ans = read():lower()

if ans == "y" or ans == "yes" then
  print("\nReiniciando con amorâ€¦ ğŸ’•")
  sleep(1)
  os.reboot()
else
  print("\nReinicio cancelado. Â¡Disfruta con amor! ğŸ˜Š")
end
